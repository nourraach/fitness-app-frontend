<div class="recognition-result-container" *ngIf="recognitionResult">
  <!-- Result Header -->
  <div class="result-header">
    <div class="result-image" *ngIf="originalImage">
      <img [src]="originalImage" alt="Image analysée" />
    </div>
    
    <div class="result-info">
      <div class="food-identification">
        <h3 class="food-name">
          <i [class]="getCategoryIcon(recognitionResult.category || 'default')"></i>
          {{ recognitionResult.name || recognitionResult.foodName }}
        </h3>
        <span class="food-category">{{ recognitionResult.category || 'Non classé' }}</span>
      </div>
      
      <div class="confidence-indicator">
        <div class="confidence-score" [style.color]="getConfidenceColor(recognitionResult.confidence)">
          <i [class]="getConfidenceIcon(recognitionResult.confidence)"></i>
          <span>{{ (recognitionResult.confidence * 100).toFixed(0) }}% de confiance</span>
        </div>
        <div class="confidence-text">
          {{ getConfidenceText(recognitionResult.confidence) }}
        </div>
      </div>
    </div>
  </div>

  <!-- Quantity Selection -->
  <div class="quantity-section">
    <h4>Quantité consommée</h4>
    <div class="quantity-input-group">
      <label for="quantity" class="quantity-label">Quantité (g) :</label>
      <div class="quantity-controls">
        <button 
          (click)="selectedQuantity = Math.max(1, selectedQuantity - 10)"
          class="quantity-btn"
          aria-label="Diminuer la quantité"
        >
          <i class="fas fa-minus"></i>
        </button>
        <input
          id="quantity"
          type="number"
          [(ngModel)]="selectedQuantity"
          (ngModelChange)="onQuantityChange()"
          min="1"
          max="2000"
          class="quantity-input"
          aria-label="Quantité en grammes"
        />
        <button 
          (click)="selectedQuantity = Math.min(2000, selectedQuantity + 10)"
          class="quantity-btn"
          aria-label="Augmenter la quantité"
        >
          <i class="fas fa-plus"></i>
        </button>
      </div>
    </div>
    
    <!-- Quick Quantity Buttons -->
    <div class="quick-quantities">
      <button 
        *ngFor="let qty of [50, 100, 150, 200, 250]"
        (click)="selectedQuantity = qty; onQuantityChange()"
        class="quick-qty-btn"
        [class.active]="selectedQuantity === qty"
      >
        {{ qty }}g
      </button>
    </div>
  </div>

  <!-- Nutritional Information -->
  <div class="nutrition-section">
    <div class="nutrition-header" (click)="toggleNutritionDetails()">
      <h4>
        <i class="fas fa-chart-pie"></i>
        Informations nutritionnelles
      </h4>
      <button class="toggle-btn" [class.expanded]="showNutritionDetails">
        <i class="fas fa-chevron-down"></i>
      </button>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoadingNutrition" class="nutrition-loading">
      <div class="loading-spinner"></div>
      <span>Calcul des valeurs nutritionnelles...</span>
    </div>

    <!-- Nutrition Summary -->
    <div *ngIf="nutritionalInfo && !isLoadingNutrition" class="nutrition-summary">
      <div class="calories-highlight">
        <div class="calories-value">{{ getCaloriesPerServing() }}</div>
        <div class="calories-label">Calories</div>
      </div>
      
      <div class="macros-grid">
        <div class="macro-item">
          <div class="macro-value">{{ formatNutrientValue((nutritionalInfo.protein || nutritionalInfo.proteines || 0) * selectedQuantity / 100, 'g') }}</div>
          <div class="macro-label">Protéines</div>
        </div>
        <div class="macro-item">
          <div class="macro-value">{{ formatNutrientValue((nutritionalInfo.carbohydrates || nutritionalInfo.glucides || 0) * selectedQuantity / 100, 'g') }}</div>
          <div class="macro-label">Glucides</div>
        </div>
        <div class="macro-item">
          <div class="macro-value">{{ formatNutrientValue((nutritionalInfo.fat || nutritionalInfo.lipides || 0) * selectedQuantity / 100, 'g') }}</div>
          <div class="macro-label">Lipides</div>
        </div>
      </div>
    </div>

    <!-- Detailed Nutrition -->
    <div *ngIf="showNutritionDetails && nutritionalInfo && !isLoadingNutrition" class="nutrition-details">
      <div class="nutrients-grid">
        <div class="nutrient-row">
          <span class="nutrient-name">Fibres</span>
          <span class="nutrient-value">{{ formatNutrientValue((nutritionalInfo.fiber || 0) * selectedQuantity / 100, 'g') }}</span>
        </div>
        <div class="nutrient-row">
          <span class="nutrient-name">Sucres</span>
          <span class="nutrient-value">{{ formatNutrientValue((nutritionalInfo.sugar || 0) * selectedQuantity / 100, 'g') }}</span>
        </div>
        <div class="nutrient-row">
          <span class="nutrient-name">Sodium</span>
          <span class="nutrient-value">{{ formatNutrientValue((nutritionalInfo.sodium || 0) * selectedQuantity / 100, 'g') }}</span>
        </div>
        <div class="nutrient-row" *ngIf="nutritionalInfo.vitamins">
          <span class="nutrient-name">Vitamines</span>
          <span class="nutrient-value">{{ nutritionalInfo.vitamins | json }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Alternative Suggestions -->
  <div class="alternatives-section" *ngIf="recognitionResult.alternatives && recognitionResult.alternatives.length > 0">
    <h4>Autres possibilités</h4>
    <div class="alternatives-list">
      <button
        *ngFor="let alt of recognitionResult.alternatives"
        class="alternative-item"
        (click)="selectAlternative(alt)"
        [title]="'Aliment alternatif: ' + alt.name"
      >
        <span class="alt-name">{{ alt.name }}</span>
        <span class="alt-category">{{ alt.category }}</span>
      </button>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="action-buttons">
    <button
      (click)="onAddToMeal()"
      class="add-btn primary-btn"
      [disabled]="!selectedQuantity || selectedQuantity <= 0"
    >
      <i class="fas fa-plus"></i>
      <span>Ajouter au repas</span>
    </button>
    
    <button
      (click)="onTryAgain()"
      class="retry-btn secondary-btn"
    >
      <i class="fas fa-camera"></i>
      <span>Nouvelle photo</span>
    </button>
    
    <button
      (click)="onManualEntry()"
      class="manual-btn secondary-btn"
    >
      <i class="fas fa-keyboard"></i>
      <span>Saisie manuelle</span>
    </button>
  </div>

  <!-- Confidence Warning -->
  <div 
    *ngIf="recognitionResult.confidence < 0.6" 
    class="confidence-warning"
  >
    <i class="fas fa-exclamation-triangle"></i>
    <div class="warning-content">
      <strong>Reconnaissance incertaine</strong>
      <p>La reconnaissance automatique n'est pas très fiable pour cette image. Vérifiez le résultat ou utilisez la saisie manuelle.</p>
    </div>
  </div>
</div>

<!-- No Result State -->
<div *ngIf="!recognitionResult" class="no-result">
  <div class="no-result-icon">
    <i class="fas fa-search"></i>
  </div>
  <h3>Aucun résultat</h3>
  <p>Aucun aliment n'a pu être reconnu dans cette image.</p>
  <div class="no-result-actions">
    <button (click)="onTryAgain()" class="retry-btn primary-btn">
      <i class="fas fa-camera"></i>
      <span>Essayer une autre photo</span>
    </button>
    <button (click)="onManualEntry()" class="manual-btn secondary-btn">
      <i class="fas fa-keyboard"></i>
      <span>Saisie manuelle</span>
    </button>
  </div>
</div>