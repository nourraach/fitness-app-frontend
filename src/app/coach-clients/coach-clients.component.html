<div class="coach-clients-container">
  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <h1>üë• Mes Clients</h1>
      <p class="subtitle">G√©rez vos clients et suivez leurs progr√®s</p>
    </div>
    <button class="btn-primary" (click)="openAssignModal()">
      <i class="pi pi-plus"></i>
      Assigner un client
    </button>
  </div>

  <!-- Messages -->
  <div *ngIf="successMessage" class="alert alert-success">
    ‚úì {{ successMessage }}
  </div>
  <div *ngIf="errorMessage" class="alert alert-error">
    ‚úó {{ errorMessage }}
  </div>

  <!-- Search and Filter Bar -->
  <div class="search-filter-bar">
    <div class="search-section">
      <i class="pi pi-search"></i>
      <input 
        type="text" 
        [(ngModel)]="searchTerm" 
        placeholder="Rechercher un client par nom ou email..."
        class="search-input">
    </div>
    
    <div class="filter-section">
      <select [(ngModel)]="sortBy" class="sort-select">
        <option value="name">Trier par nom</option>
        <option value="progressRate">Trier par progr√®s</option>
        <option value="programsCount">Trier par programmes</option>
        <option value="lastActivity">Trier par activit√©</option>
      </select>
      
      <button 
        class="filter-btn" 
        [class.active]="showInactiveOnly"
        (click)="toggleInactiveFilter()">
        <i class="pi pi-exclamation-triangle"></i>
        Inactifs seulement
      </button>
    </div>
  </div>

  <!-- Enhanced Stats Summary -->
  <div class="stats-summary">
    <div class="stat-card">
      <div class="stat-icon">üë•</div>
      <div class="stat-content">
        <div class="stat-value">{{ clientStatistics?.totalClients || myClients.length }}</div>
        <div class="stat-label">Clients Totaux</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">‚úÖ</div>
      <div class="stat-content">
        <div class="stat-value">{{ clientStatistics?.activeClients || getActiveClientsCount() }}</div>
        <div class="stat-label">Clients Actifs</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">‚ö†Ô∏è</div>
      <div class="stat-content">
        <div class="stat-value">{{ getInactiveClientsCount() }}</div>
        <div class="stat-label">Clients Inactifs</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">üìä</div>
      <div class="stat-content">
        <div class="stat-value">{{ getClientsWithProgramsCount() }}</div>
        <div class="stat-label">Avec Programmes</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">üìà</div>
      <div class="stat-content">
        <div class="stat-value">{{ getAverageProgressRate() }}%</div>
        <div class="stat-label">Progr√®s Moyen</div>
      </div>
    </div>
  </div>

  <!-- Inactive Clients Alert -->
  <div *ngIf="hasInactiveAlerts()" class="alert alert-warning">
    <i class="pi pi-exclamation-triangle"></i>
    <strong>Attention:</strong> {{ getInactiveAlerts().length }} client(s) inactif(s) depuis plus de 7 jours.
    <button class="btn-link" (click)="showInactiveOnly = true">Voir les clients inactifs</button>
  </div>

  <!-- Clients List -->
  <div *ngIf="loading && myClients.length === 0" class="loading">
    Chargement des clients...
  </div>

  <div *ngIf="!loading && filteredClients.length === 0" class="empty-state">
    <div class="empty-icon">üë•</div>
    <h3>Aucun client trouv√©</h3>
    <p *ngIf="searchTerm">Aucun client ne correspond √† votre recherche</p>
    <p *ngIf="!searchTerm">Commencez par assigner des clients √† votre liste</p>
    <button class="btn-primary" (click)="openAssignModal()" *ngIf="!searchTerm">
      Assigner un client
    </button>
  </div>

  <div class="clients-grid" *ngIf="filteredClients.length > 0">
    <div *ngFor="let client of filteredClients" class="client-card" [class.inactive-client]="client.isInactive">
      <div class="client-header">
        <div class="client-avatar">
          <i class="pi pi-user"></i>
        </div>
        <div class="client-info">
          <h3>{{ client.name }}</h3>
          <p class="client-email">{{ client.email }}</p>
          <div class="status-badges">
            <span class="status-badge" [ngClass]="getStatusClass(client.status)">
              {{ getStatusLabel(client.status) }}
            </span>
            <span *ngIf="client.isInactive" class="inactive-badge">
              <i class="pi pi-exclamation-triangle"></i>
              Inactif
            </span>
          </div>
        </div>
      </div>

      <div class="client-details">
        <div class="detail-item">
          <i class="pi pi-calendar"></i>
          <span>Assign√© le {{ client.assignedDate | date:'dd/MM/yyyy' }}</span>
        </div>
        <div class="detail-item">
          <i class="pi pi-clock"></i>
          <span>{{ formatLastActivity(client.lastActivity) }}</span>
        </div>
        <div class="detail-item" *ngIf="client.phone">
          <i class="pi pi-phone"></i>
          <span>{{ client.phone }}</span>
        </div>
      </div>

      <div class="client-stats">
        <div class="stat-item">
          <div class="stat-label">Programmes</div>
          <div class="stat-value">{{ client.programsCount }}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Progr√®s</div>
          <div class="stat-value" [ngClass]="client.progressClass">
            {{ client.progressRate }}%
          </div>
        </div>
      </div>

      <div class="client-actions">
        <button class="btn-view" (click)="viewClientDetails(client)">
          <i class="pi pi-eye"></i>
          Voir d√©tails
        </button>
        <button class="btn-remove" (click)="unassignClient(client)">
          <i class="pi pi-times"></i>
          Retirer
        </button>
      </div>
    </div>
  </div>

  <!-- Modal: Assign Client -->
  <div *ngIf="showAssignModal" class="modal-overlay" (click)="closeAssignModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Assigner un nouveau client</h2>
        <button class="btn-close" (click)="closeAssignModal()">‚úï</button>
      </div>

      <div class="modal-body">
        <div *ngIf="errorMessage" class="alert alert-error">
          {{ errorMessage }}
        </div>

        <div *ngIf="availableClients.length === 0" class="empty-state">
          <p>Aucun client disponible pour le moment</p>
        </div>

        <div class="available-clients-list" *ngIf="availableClients.length > 0">
          <div *ngFor="let client of availableClients" class="available-client-item">
            <div class="client-avatar-small">
              <i class="pi pi-user"></i>
            </div>
            <div class="client-info-small">
              <h4>{{ client.name }}</h4>
              <p>{{ client.email }}</p>
            </div>
            <button class="btn-assign" (click)="assignClient(client)" [disabled]="loading">
              <i class="pi pi-plus"></i>
              Assigner
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: Client Details -->
  <div *ngIf="selectedClient" class="modal-overlay" (click)="closeClientDetails()">
    <div class="modal-content modal-large" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>D√©tails du Client</h2>
        <button class="btn-close" (click)="closeClientDetails()">‚úï</button>
      </div>

      <div class="modal-body">
        <div class="client-details-full">
          <div class="detail-section">
            <h3>üìã Informations Personnelles</h3>
            <div class="detail-grid">
              <div class="detail-row">
                <span class="label">Nom:</span>
                <span class="value">{{ selectedClient.name }}</span>
              </div>
              <div class="detail-row">
                <span class="label">Email:</span>
                <span class="value">{{ selectedClient.email }}</span>
              </div>
              <div class="detail-row" *ngIf="selectedClient.age">
                <span class="label">√Çge:</span>
                <span class="value">{{ selectedClient.age }} ans</span>
              </div>
              <div class="detail-row" *ngIf="selectedClient.phone">
                <span class="label">T√©l√©phone:</span>
                <span class="value">{{ selectedClient.phone }}</span>
              </div>
            </div>
          </div>

          <div class="detail-section">
            <h3>üìä Statistiques</h3>
            <div class="detail-grid">
              <div class="detail-row">
                <span class="label">Date d'assignation:</span>
                <span class="value">{{ selectedClient.assignedDate | date:'dd/MM/yyyy' }}</span>
              </div>
              <div class="detail-row">
                <span class="label">Derni√®re activit√©:</span>
                <span class="value">{{ formatLastActivity(selectedClient.lastActivity) }}</span>
              </div>
              <div class="detail-row">
                <span class="label">Programmes actifs:</span>
                <span class="value">{{ selectedClient.programsCount }}</span>
              </div>
              <div class="detail-row">
                <span class="label">Taux de progr√®s:</span>
                <span class="value" [ngClass]="selectedClient.progressClass">
                  {{ selectedClient.progressRate }}%
                </span>
              </div>
              <div class="detail-row" *ngIf="selectedClient.isInactive">
                <span class="label">Statut:</span>
                <span class="value inactive-warning">
                  <i class="pi pi-exclamation-triangle"></i>
                  Client inactif depuis plus de 7 jours
                </span>
              </div>
            </div>
          </div>

          <div class="detail-actions">
            <button class="btn-primary">Voir les programmes</button>
            <button class="btn-primary">G√©n√©rer un rapport</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
