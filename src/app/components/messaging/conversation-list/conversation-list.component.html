<div class="conversation-list">
  <!-- Search Bar -->
  <div class="search-container">
    <div class="search-input-wrapper">
      <i class="fas fa-search search-icon"></i>
      <input
        type="text"
        [(ngModel)]="searchTerm"
        (input)="onSearchChange()"
        placeholder="Rechercher une conversation..."
        class="search-input"
        aria-label="Rechercher dans les conversations"
      />
      <button
        *ngIf="searchTerm"
        (click)="searchTerm = ''; onSearchChange()"
        class="clear-search-btn"
        aria-label="Effacer la recherche"
      >
        <i class="fas fa-times"></i>
      </button>
    </div>
  </div>

  <!-- Conversations List -->
  <div class="conversations-container">
    <div
      *ngFor="let conversation of filteredConversations; trackBy: trackByConversation"
      class="conversation-item"
      [class.selected]="selectedConversationId === conversation.id"
      [class.unread]="getUnreadCount(conversation) > 0"
      (click)="selectConversation(conversation)"
      role="button"
      tabindex="0"
      [attr.aria-label]="'Conversation avec ' + conversation.participantName"
      (keydown.enter)="selectConversation(conversation)"
      (keydown.space)="selectConversation(conversation)"
    >
      <!-- Avatar -->
      <div class="avatar-container">
        <img
          [src]="conversation.participantAvatar || '/assets/images/default-avatar.png'"
          [alt]="'Avatar de ' + conversation.participantName"
          class="avatar"
          onerror="this.src='/assets/images/default-avatar.png'"
        />
        <div
          *ngIf="conversation.isOnline"
          class="online-indicator"
          title="En ligne"
        ></div>
      </div>

      <!-- Conversation Info -->
      <div class="conversation-info">
        <div class="conversation-header">
          <h4 class="participant-name">{{ conversation.participantName }}</h4>
          <span class="last-message-time">
            {{ formatLastMessageTime(conversation.lastMessageTime) }}
          </span>
        </div>

        <div class="conversation-preview">
          <p class="last-message" [class.unread-message]="getUnreadCount(conversation) > 0">
            <span *ngIf="conversation.lastMessage?.senderId === conversation.currentUserId" class="message-prefix">
              Vous: 
            </span>
            {{ truncateMessage(conversation.lastMessage?.content || 'Aucun message') }}
          </p>
          
          <!-- Unread Badge -->
          <div
            *ngIf="getUnreadCount(conversation) > 0"
            class="unread-badge"
            [attr.aria-label]="getUnreadCount(conversation) + ' messages non lus'"
          >
            {{ getUnreadCount(conversation) > 99 ? '99+' : getUnreadCount(conversation) }}
          </div>
        </div>

        <!-- Typing Indicator -->
        <div *ngIf="conversation.isTyping" class="typing-indicator">
          <span class="typing-text">{{ conversation.participantName }} est en train d'écrire</span>
          <div class="typing-dots">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="filteredConversations.length === 0" class="empty-state">
      <div class="empty-icon">
        <i class="fas fa-comments"></i>
      </div>
      <h3>{{ searchTerm ? 'Aucune conversation trouvée' : 'Aucune conversation' }}</h3>
      <p>
        {{ searchTerm 
          ? 'Essayez de modifier votre recherche' 
          : 'Commencez une nouvelle conversation pour voir vos messages ici' 
        }}
      </p>
    </div>
  </div>
</div>